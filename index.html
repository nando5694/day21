<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#fff9f5">
    <meta name="color-scheme" content="light">
    
    <title>Felices 21 - Daycita</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Forzar modo claro en CSS */
            color-scheme: light;
            
            --rose-gold-dark: #b76e79;
            --rose-gold-main: #d4af37;
            --rose-gold-light: #f4e1e4;
            --cream-bg: #fff9f5;
            --text-dark: #444444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(-45deg, var(--rose-gold-light), var(--cream-bg), #fad0c4, var(--cream-bg));
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            background-color: var(--cream-bg);
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Fondo Bokeh */
        .bokeh-container {
            position: fixed; width: 100vw; height: 100vh; top: 0; left: 0; z-index: -1; pointer-events: none;
        }
        .bokeh {
            position: absolute; border-radius: 50%;
            background: rgba(212, 175, 55, 0.3);
            box-shadow: 0 0 20px rgba(183, 110, 121, 0.2);
            animation: floatUp linear infinite;
        }

        @keyframes floatUp {
            to { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        /* Marco Principal */
        .main-card {
            background: rgba(255, 255, 255, 0.95);
            max-width: 900px; width: 100%;
            border-radius: 30px;
            padding: 50px 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(183, 110, 121, 0.25);
            border: 3px solid transparent;
            background-image: linear-gradient(white, white), linear-gradient(45deg, var(--rose-gold-dark), var(--rose-gold-main));
            background-origin: border-box;
            background-clip: padding-box, border-box;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .animate-in {
            opacity: 0; transform: translateY(30px); transition: all 0.8s ease-out;
        }
        .animate-in.visible { opacity: 1; transform: translateY(0); }

        h1.big-title {
            font-family: 'Playfair Display', serif;
            font-size: 4.5rem; font-weight: 700;
            background: linear-gradient(to right, var(--rose-gold-dark), var(--rose-gold-main), var(--rose-gold-dark));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 10px; letter-spacing: -1px;
        }

        .script-subtitle {
            font-family: 'Great Vibes', cursive; font-size: 2.5rem; color: var(--rose-gold-dark);
            margin-bottom: 40px; text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }

        /* CARRUSEL */
        .carousel-frame {
            width: 100%; max-width: 650px; margin: 0 auto 30px;
            aspect-ratio: 3/4;
            border-radius: 20px; overflow: hidden; position: relative;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border: 5px solid white; outline: 2px solid var(--rose-gold-light);
        }

        .carousel-slide {
            position: absolute; inset: 0; opacity: 0; transition: opacity 1s ease-in-out;
            display: flex; justify-content: center; align-items: center; 
        }
        .carousel-slide.active-slide { opacity: 1; z-index: 2; }

        .carousel-slide img {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; object-fit: cover;
            transform: scale(1); transition: transform 6s ease;
            z-index: 1;
        }
        .carousel-slide.active-slide img { transform: scale(1.1); }

        /* --- BOT√ìN SORPRESA --- */
        .surprise-overlay {
            position: absolute;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(183, 110, 121, 0.85); 
            backdrop-filter: blur(4px);
            padding: 20px;
            border-radius: 50%;
            width: 200px; 
            height: 200px;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.8);
            border: 4px solid rgba(255, 255, 255, 0.9);
            cursor: pointer;
            animation: pulse-surprise-big 2s infinite;
            transition: transform 0.3s;
        }

        .surprise-overlay:hover {
            transform: scale(1.05);
            background: rgba(183, 110, 121, 0.95);
        }

        .gift-icon { font-size: 4.5rem; margin-bottom: 5px; }
        
        .gift-label { 
            font-family: 'Lato', sans-serif;
            color: #fff;
            font-size: 1.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            line-height: 1.2;
            margin-top: 5px;
        }

        @keyframes pulse-surprise-big {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            50% { transform: scale(1.08); box-shadow: 0 0 30px 10px rgba(212, 175, 55, 0.4); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }

        /* Nav Buttons */
        .nav-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            font-size: 2rem; color: white; background: rgba(183, 110, 121, 0.5);
            padding: 10px 15px; cursor: pointer; border-radius: 50%;
            transition: 0.3s; z-index: 20; user-select: none;
            backdrop-filter: blur(5px);
        }
        .nav-btn:hover { background: var(--rose-gold-dark); }
        .prev-btn { left: 15px; } .next-btn { right: 15px; }

        /* Carta */
        .letter-section {
            margin-top: 50px; padding: 30px;
            background: #fffcf8;
            border: 1px solid var(--rose-gold-light);
            border-radius: 15px;
            position: relative;
        }
        .letter-section::before {
            content: '‚Äú'; font-family: 'Playfair Display', serif;
            position: absolute; top: -20px; left: 20px;
            font-size: 5rem; color: var(--rose-gold-light); opacity: 0.5;
        }
        .letter-content {
            font-family: 'Playfair Display', serif; font-size: 1.2rem;
            line-height: 1.8; color: #666; font-style: italic;
        }
        .signature {
            font-family: 'Great Vibes', cursive; font-size: 2rem;
            color: var(--rose-gold-dark); margin-top: 20px; text-align: right;
        }

        /* MODAL DEL REGALO */
        .gift-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(74, 46, 49, 0.95);
            backdrop-filter: blur(5px);
            z-index: 300;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }
        .gift-modal-overlay.active { opacity: 1; pointer-events: all; }

        .gift-modal-content {
            background: var(--cream-bg);
            padding: 30px; border-radius: 25px; text-align: center;
            max-width: 500px; width: 90%;
            border: 4px solid var(--rose-gold-main);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transform: scale(0.7);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .gift-modal-overlay.active .gift-modal-content { transform: scale(1); }

        .close-modal {
            position: absolute; top: 15px; right: 20px;
            font-size: 30px; color: var(--rose-gold-dark);
            cursor: pointer; transition: color 0.3s; z-index: 10;
        }
        .close-modal:hover { color: var(--rose-gold-main); }

        /* Fases y Contenido */
        .phase { display: none; width: 100%; animation: fadeIn 0.5s; }
        .phase.active-phase { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .funny-title { font-family: 'Lato', sans-serif; font-size: 1.5rem; color: #666; margin-bottom: 20px; }
        .funny-img { max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .gift-title { font-family: 'Great Vibes', cursive; font-size: 3rem; color: var(--rose-gold-dark); margin-bottom: 5px; }
        .gift-text { font-family: 'Playfair Display', serif; font-size: 1.2rem; margin-bottom: 15px; color: #666; }
        
        .final-img {
            max-width: 100%; height: auto; border-radius: 10px;
            border: 2px solid var(--rose-gold-main); padding: 5px; background: white;
            max-height: 45vh; 
        }

        .to-be-continued {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            font-weight: 700;
            font-style: italic;
            color: var(--rose-gold-dark);
            margin-top: 15px;
            letter-spacing: 2px;
            opacity: 0.8;
            animation: pulse-text 2s infinite ease-in-out;
        }

        .bubita-msg {
            font-family: 'Great Vibes', cursive;
            font-size: 2.2rem;
            color: var(--text-dark);
            margin-top: 10px;
        }

        @keyframes pulse-text {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        /* ESTILOS DEL BOT√ìN DE ESPERA */
        .wait-btn {
            background: linear-gradient(45deg, var(--rose-gold-dark), var(--rose-gold-main));
            color: white; border: none; padding: 12px 30px; border-radius: 25px;
            font-family: 'Lato', sans-serif; font-size: 1.1rem; cursor: pointer;
            margin-top: 20px; transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 5px 15px rgba(183, 110, 121, 0.4);
        }
        .wait-btn:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(183, 110, 121, 0.6); }


        /* Confeti */
        .sparkle-confetti {
            position: fixed; width: 8px; height: 12px;
            background: linear-gradient(to bottom right, var(--rose-gold-main), var(--rose-gold-dark));
            top: -20px; z-index: 100; pointer-events: none;
            animation: fall-sparkle linear forwards; opacity: 0.8;
        }
        @keyframes fall-sparkle {
            to { transform: translateY(105vh) rotateX(360deg) rotateY(360deg); }
        }

        @media (max-width: 768px) {
            h1.big-title { font-size: 3rem; }
            .script-subtitle { font-size: 2rem; }
            .surprise-overlay { width: 160px; height: 160px; }
            .gift-label { font-size: 1.4rem; }
            .gift-modal-content { padding: 20px; }
            .bubita-msg { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="bokeh-container" id="bokehBg"></div>

    <div class="gift-modal-overlay" id="giftModal">
        <div class="gift-modal-content">
            <span class="close-modal" onclick="closeGiftModal()">&times;</span>
            
            <div id="phase1" class="phase">
                <h2 class="funny-title">Tu regalo viene en camino... üööüí®</h2>
                <img src="https://media.tenor.com/0JWcKoeZ3kkAAAAj/bubu-bubu-dudu.gif" alt="Cargando regalo..." class="funny-img">
                <p style="margin-top: 15px; font-style: italic; color: #888;">Procesando env√≠o especial...</p>
            </div>

            <div id="phase2" class="phase">
                <h2 class="gift-title">¬°Sorpresa!</h2>
                <p class="gift-text">Feliz Cumplea√±os</p>
                <img src="foto6.jpg" alt="Regalo Final" class="final-img">
                <div class="to-be-continued">Continuar√°...</div>
                <div class="bubita-msg">Disfruta tu d√≠a Bubita ‚ù§Ô∏è</div>
            </div>
        </div>
    </div>

    <div class="gift-modal-overlay" id="waitModal">
        <div class="gift-modal-content">
            <div style="font-size: 5rem; margin-bottom: 10px; animation: pulse-text 2s infinite;">‚è≥</div>
            <h2 class="gift-title" style="font-size: 2.5rem;">A√∫n no...</h2>
            <p class="gift-text" style="font-size: 1.1rem; line-height: 1.6;">
                La magia est√° programada para el<br>
                <strong style="color: var(--rose-gold-dark);">9 de Febrero a las 5:30 PM</strong><br>
                (Hora Guatemala)
            </p>
            <p style="font-size: 0.9rem; color: #888; margin-bottom: 10px;">¬°La paciencia tiene su recompensa!</p>
            <button class="wait-btn" onclick="closeWaitModal()">Entendido</button>
        </div>
    </div>

    <div class="main-card">
        <header class="animate-in">
            <h1 class="big-title">Felices 21 A√±os</h1>
            <p class="script-subtitle">Momentos que valen oro</p>
        </header>

        <div class="carousel-frame animate-in" style="transition-delay: 0.2s;">
            <div class="carousel-slide active-slide"><img src="foto1.jpg" alt="Foto 1"></div>
            <div class="carousel-slide"><img src="foto2.jpg" alt="Foto 2"></div>
            <div class="carousel-slide"><img src="foto3.jpg" alt="Foto 3"></div>

            <div class="carousel-slide">
                <img src="foto4.jpg" alt="Foto 4">
                <div class="surprise-overlay" onclick="startGiftSequence()">
                    <div class="gift-icon">üéÅ</div>
                    <div class="gift-label" id="giftLabelText">√Åbreme</div>
                </div>
            </div>
            
            <div class="nav-btn prev-btn" onclick="changeSlide(-1)">&#10094;</div>
            <div class="nav-btn next-btn" onclick="changeSlide(1)">&#10095;</div>
        </div>

        <div class="letter-section animate-in" style="transition-delay: 0.4s;">
            <div class="letter-content">
                <p>Veinti√∫n a√±os llenos de historias, risas y aprendizajes. Hoy celebramos no solo el tiempo que ha pasado, sino la maravillosa persona en la que te has convertido. Disfruta cada foto y mant√©n los ojos bien abiertos...</p>
                <p style="margin-top: 15px;">A veces las mejores sorpresas aparecen al final del camino.</p>
            </div>
            <div class="signature">¬°Felicidades!</div>
        </div>
    </div>

    <script>
        // --- VALIDACI√ìN DE TIEMPO (ROBUSTA) ---
        async function canOpenGift() {
            let now;
            try {
                // 1. Intentamos obtener la hora de internet
                const response = await fetch('https://worldtimeapi.org/api/timezone/America/Guatemala', { signal: AbortSignal.timeout(3000) });
                const data = await response.json();
                now = new Date(data.datetime);
            } catch (error) {
                // 2. Si falla, usamos la hora del sistema sin modificarla a√∫n
                now = new Date(); 
            }

            // 3. Convertimos esa fecha a la hora de GUATEMALA
            const gtTimeFormatter = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/Guatemala',
                year: 'numeric', month: 'numeric', day: 'numeric',
                hour: 'numeric', minute: 'numeric', hour12: false
            });
            
            const parts = gtTimeFormatter.formatToParts(now);
            const getPart = (type) => parseInt(parts.find(p => p.type === type).value);
            
            const year = getPart('year');
            const month = getPart('month');
            const day = getPart('day');
            const hour = getPart('hour');
            const minute = getPart('minute'); // A√±adido para verificar minutos
            
            // --- REGLAS: 9 de Febrero de 2026, 17:30 (5:30 PM) ---
            if (year < 2026) return false;
            if (year > 2026) return true;
            
            if (month < 2) return false; // Antes de febrero
            if (month > 2) return true; // Marzo en adelante
            
            if (day < 9) return false; // Antes del d√≠a 9
            if (day > 9) return true; // D√≠a 10 en adelante
            
            // Verificaci√≥n de hora exacta:
            if (hour < 17) return false; // Antes de las 5 PM (0-16)
            if (hour === 17 && minute < 30) return false; // Es la hora 17, pero antes de los 30 min
            
            // Si llega aqu√≠, es 17:30 o m√°s tarde, o una hora mayor a 17 (18, 19...)
            return true;
        }

        const giftModal = document.getElementById('giftModal');
        const waitModal = document.getElementById('waitModal');
        const phase1 = document.getElementById('phase1');
        const phase2 = document.getElementById('phase2');
        const labelText = document.getElementById('giftLabelText');
        let isChecking = false;

        async function startGiftSequence() {
            if (isChecking) return; 
            
            isChecking = true;
            const originalText = labelText.innerText;
            labelText.innerText = "...";
            
            const allowed = await canOpenGift();
            
            isChecking = false;
            labelText.innerText = originalText;

            if (!allowed) {
                // MOSTRAR MODAL DE ESPERA ELEGANTE
                waitModal.classList.add('active');
                return;
            }

            // MOSTRAR REGALO REAL
            giftModal.classList.add('active');
            phase1.classList.add('active-phase');
            phase2.classList.remove('active-phase');

            setTimeout(() => {
                phase1.classList.remove('active-phase');
                phase2.classList.add('active-phase');
                for(let i=0; i<5; i++) setTimeout(launchConfetti, i*200);
            }, 4000); 
        }

        function closeGiftModal() {
            giftModal.classList.remove('active');
            setTimeout(() => {
                phase1.classList.add('active-phase');
                phase2.classList.remove('active-phase');
            }, 500);
        }

        function closeWaitModal() {
            waitModal.classList.remove('active');
        }

        // --- VISUALES Y CARRUSEL ---
        document.addEventListener("DOMContentLoaded", () => {
            const animatedElements = document.querySelectorAll('.animate-in');
            animatedElements.forEach((el, index) => {
                setTimeout(() => { el.classList.add('visible'); }, 100 * index);
            });
            createBokehBg();
        });

        let currentSlide = 0;
        const slides = document.querySelectorAll('.carousel-slide');
        const totalSlides = slides.length;
        let slideInterval;

        function showSlide(index) {
            slides.forEach(slide => slide.classList.remove('active-slide'));
            currentSlide = (index + totalSlides) % totalSlides;
            slides[currentSlide].classList.add('active-slide');
        }

        function changeSlide(direction) {
            clearInterval(slideInterval);
            showSlide(currentSlide + direction);
            // Solo sigue girando si NO hay modales abiertos
            if(!giftModal.classList.contains('active') && !waitModal.classList.contains('active')) {
                startAutoSlide();
            }
        }

        function startAutoSlide() {
            clearInterval(slideInterval);
            slideInterval = setInterval(() => {
                if(!giftModal.classList.contains('active') && !waitModal.classList.contains('active')) {
                    showSlide(currentSlide + 1);
                }
            }, 5000);
        }

        startAutoSlide();

        function createBokehBg() {
            const container = document.getElementById('bokehBg');
            for (let i = 0; i < 30; i++) {
                let sparkle = document.createElement('div');
                sparkle.className = 'bokeh';
                let size = Math.random() * 20 + 10 + 'px';
                sparkle.style.width = size; sparkle.style.height = size;
                sparkle.style.left = Math.random() * 100 + 'vw';
                sparkle.style.top = Math.random() * 100 + 'vh';
                sparkle.style.opacity = Math.random() * 0.4;
                sparkle.style.animationDuration = Math.random() * 20 + 10 + 's';
                sparkle.style.animationDelay = Math.random() * -20 + 's';
                container.appendChild(sparkle);
            }
        }

        function launchConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('sparkle-confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 5000);
            }
        }
        setTimeout(launchConfetti, 1000);
        setInterval(() => launchConfetti(), 8000);
    </script>
</body>
</html>
